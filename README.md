# Melange DB ğŸª

> åŸºäº sled æ¶æ„æ·±åº¦ä¼˜åŒ–çš„ä¸‹ä¸€ä»£é«˜æ€§èƒ½åµŒå…¥å¼æ•°æ®åº“

## é¡¹ç›®ç®€ä»‹

Melange DB æ˜¯ä¸€ä¸ªåŸºäº sled æ¶æ„è¿›è¡Œæ·±åº¦æ€§èƒ½ä¼˜åŒ–çš„åµŒå…¥å¼æ•°æ®åº“ï¼Œä¸“æ³¨äºè¶…è¶Š RocksDB çš„æ€§èƒ½è¡¨ç°ã€‚é€šè¿‡ SIMD æŒ‡ä»¤ä¼˜åŒ–ã€æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿå’Œå¸ƒéš†è¿‡æ»¤å™¨ç­‰æŠ€æœ¯ï¼Œå®ç°æè‡´çš„è¯»å†™æ€§èƒ½ã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸš€ æè‡´æ€§èƒ½ä¼˜åŒ–
- **SIMD ä¼˜åŒ–çš„ Key æ¯”è¾ƒ**: åŸºäº ARM64 NEON æŒ‡ä»¤é›†çš„é«˜æ€§èƒ½æ¯”è¾ƒ
- **å¤šçº§å—ç¼“å­˜ç³»ç»Ÿ**: çƒ­/æ¸©/å†·ä¸‰çº§ç¼“å­˜ï¼ŒLRU æ·˜æ±°ç­–ç•¥
- **æ™ºèƒ½å¸ƒéš†è¿‡æ»¤å™¨**: 1% è¯¯åˆ¤ç‡ï¼Œå¿«é€Ÿè¿‡æ»¤ä¸å­˜åœ¨æŸ¥è¯¢
- **é¢„å–æœºåˆ¶**: æ™ºèƒ½é¢„å–ç®—æ³•æå‡é¡ºåºè®¿é—®æ€§èƒ½

### ğŸ”’ å¹¶å‘å®‰å…¨
- **æ— é”æ•°æ®ç»“æ„**: åŸºäº concurrent-map çš„é«˜å¹¶å‘è®¾è®¡
- **çº¿ç¨‹å®‰å…¨**: å®Œå…¨çš„ Send + Sync trait å®ç°
- **åŸå­æ€§ä¿è¯**: ACID å…¼å®¹çš„äº‹åŠ¡æ”¯æŒ

### ğŸ“¦ é«˜æ•ˆå†…å­˜ç®¡ç†
- **å¢é‡åºåˆ—åŒ–**: å‡å°‘ IO å¼€é”€çš„åºåˆ—åŒ–ç­–ç•¥
- **æ™ºèƒ½ç¼“å­˜ç­–ç•¥**: è‡ªé€‚åº”ç¼“å­˜æ›¿æ¢ç®—æ³•
- **å†…å­˜æ˜ å°„ä¼˜åŒ–**: é«˜æ•ˆçš„æ–‡ä»¶æ˜ å°„æœºåˆ¶

## å¿«é€Ÿå¼€å§‹

```rust
use melange_db::{Db, Config};

fn main() -> anyhow::Result<()> {
    // é…ç½®æ•°æ®åº“
    let config = Config::new()
        .path("/path/to/database")
        .cache_capacity_bytes(512 * 1024 * 1024); // 512MB ç¼“å­˜

    // æ‰“å¼€æ•°æ®åº“
    let db: Db<1024> = config.open()?;

    // å†™å…¥æ•°æ®
    let tree = db.open_tree::<&[u8]>(b"my_tree")?;
    tree.insert(b"key", b"value")?;

    // è¯»å–æ•°æ®
    if let Some(value) = tree.get(b"key")? {
        println!("Found value: {:?}", value);
    }

    // èŒƒå›´æŸ¥è¯¢
    for kv in tree.range(b"start"..b"end") {
        let (key, value) = kv?;
        println!("{}: {:?}", String::from_utf8_lossy(&key), value);
    }

    Ok(())
}
```

## æ€§èƒ½è¡¨ç°

### åŸºå‡†æµ‹è¯•ç»“æœ (Apple M1)

| æ“ä½œç±»å‹ | å¹³å‡å»¶è¿Ÿ | P95 å»¶è¿Ÿ | P99 å»¶è¿Ÿ | ååé‡ |
|---------|---------|---------|---------|--------|
| **å•æ¡æ’å…¥** | 0.78 Âµs | 1.54 Âµs | 7.17 Âµs | 1.28M ops/sec |
| **å•æ¡è¯»å–** | 0.37 Âµs | 0.42 Âµs | 1.21 Âµs | 2.70M ops/sec |
| **æ‰¹é‡æ’å…¥** | 1.40 Âµs | - | - | 714K ops/sec |
| **æ›´æ–°æ“ä½œ** | 2.22 Âµs | - | - | 450K ops/sec |

### Releaseæ¨¡å¼å®æµ‹æ€§èƒ½

| æ“ä½œç±»å‹ | å¹³å‡å»¶è¿Ÿ | ååé‡ |
|---------|---------|--------|
| **å•æ¡æ’å…¥** | 9.92 Âµs | 100.8K ops/sec |
| **å•æ¡è¯»å–** | 0.63 Âµs | 1.59M ops/sec |
| **æ‰¹é‡æ’å…¥** | 1.22 Âµs/op | 819.7K ops/sec |
| **æ‰¹é‡è¯»å–** | 0.47 Âµs/op | 2.15M ops/sec |
| **é«˜æ€§èƒ½å†™å…¥** | 1.23 Âµs/op | 810.2K ops/sec |
| **é«˜æ€§èƒ½è¯»å–** | 0.42 Âµs/op | 2.37M ops/sec |

### ä¸ RocksDB å¯¹æ¯”

- **å†™å…¥æ€§èƒ½**: **4.05å€** æå‡ (RocksDB: 5 Âµs/æ¡ â†’ Melange DB: 1.23 Âµs/æ¡)
- **è¯»å–æ€§èƒ½**: **1.19å€** æå‡ (RocksDB: 0.5 Âµs/æ¡ â†’ Melange DB: 0.42 Âµs/æ¡)
- **å†…å­˜æ•ˆç‡**: ä¼˜åŒ–åçš„ç¼“å­˜ç­–ç•¥ï¼Œ32.69 byteså¹³å‡è®°å½•å¤§å°
- **å®é™…ä¼˜åŒ–**: SIMDæŒ‡ä»¤ä¼˜åŒ–ã€å¸ƒéš†è¿‡æ»¤å™¨ã€å¤šçº§ç¼“å­˜ç³»ç»Ÿã€å¢é‡åºåˆ—åŒ–

## ä¼˜åŒ–æŠ€æœ¯è¯¦è§£

### 1. SIMD ä¼˜åŒ–
- **ARM64 NEON æŒ‡ä»¤é›†**: æ”¯æŒ Apple M1 å’Œæ ‘è“æ´¾ 3b+
- **16 å­—èŠ‚å¯¹é½æ¯”è¾ƒ**: 284M comparisons/sec
- **æ‰¹é‡å¤„ç†ä¼˜åŒ–**: æ”¯æŒæ‰¹é‡ key æ¯”è¾ƒæ“ä½œ

### 2. å¸ƒéš†è¿‡æ»¤å™¨
- **å¤šçº§è¿‡æ»¤å™¨**: æ”¯æŒçƒ­/æ¸©/å†·æ•°æ®åˆ†å±‚
- **å¯é…ç½®è¯¯åˆ¤ç‡**: é»˜è®¤ 1%ï¼Œå¯æŒ‰éœ€è°ƒæ•´
- **å¹¶å‘å®‰å…¨**: æ”¯æŒå¤šçº¿ç¨‹åŒæ—¶è®¿é—®

### 3. å—ç¼“å­˜ç³»ç»Ÿ
- **ä¸‰çº§ç¼“å­˜æ¶æ„**: çƒ­/æ¸©/å†·æ•°æ®åˆ†å±‚å­˜å‚¨
- **æ™ºèƒ½é¢„å–**: åŸºäºè®¿é—®æ¨¡å¼çš„é¢„å–ç®—æ³•
- **å‹ç¼©æ”¯æŒ**: è‡ªåŠ¨å‹ç¼©å¤§å—æ•°æ®
- **100% å‘½ä¸­ç‡**: åœ¨æµ‹è¯•åœºæ™¯ä¸‹çš„å®Œç¾è¡¨ç°

## æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

1. **Tree**: B+ æ ‘ç´¢å¼•ç»“æ„ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢
2. **Leaf**: å¶å­èŠ‚ç‚¹ï¼Œå­˜å‚¨å®é™…æ•°æ®
3. **ObjectCache**: å¯¹è±¡ç¼“å­˜ç³»ç»Ÿï¼Œé›†æˆä¼˜åŒ–ç»„ä»¶
4. **Heap**: å †ç®¡ç†å™¨ï¼Œè´Ÿè´£å†…å­˜åˆ†é…
5. **Index**: å¹¶å‘ç´¢å¼•ï¼Œæ”¯æŒé«˜å¹¶å‘è®¿é—®

### ä¼˜åŒ–é›†æˆ

- **é€æ˜ä¼˜åŒ–**: ç”¨æˆ·æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç å³å¯è·å¾—æ€§èƒ½æå‡
- **å‘åå…¼å®¹**: å®Œå…¨å…¼å®¹ sled çš„ API è®¾è®¡
- **æ¸è¿›å¼ä¼˜åŒ–**: å¯ä»¥é€‰æ‹©æ€§å¯ç”¨ç‰¹å®šä¼˜åŒ–åŠŸèƒ½

## é€‚ç”¨åœºæ™¯

- **é«˜é¢‘äº¤æ˜“ç³»ç»Ÿ**: ä½å»¶è¿Ÿè¯»å†™éœ€æ±‚
- **å®æ—¶æ•°æ®åˆ†æ**: é«˜ååé‡æ•°æ®å¤„ç†
- **åµŒå…¥å¼è®¾å¤‡**: èµ„æºå—é™ç¯å¢ƒä¸‹çš„é«˜æ€§èƒ½å­˜å‚¨
- **ç¼“å­˜ç³»ç»Ÿ**: ä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜çš„åç«¯å­˜å‚¨

## å¼€å‘è·¯çº¿

### âœ… å·²å®Œæˆä¼˜åŒ–
- [x] SIMD ä¼˜åŒ–çš„ key æ¯”è¾ƒ
- [x] å¤šçº§å¸ƒéš†è¿‡æ»¤å™¨
- [x] æ™ºèƒ½å—ç¼“å­˜ç³»ç»Ÿ
- [x] å¢é‡åºåˆ—åŒ–ä¼˜åŒ–
- [x] å†…å­˜ä½¿ç”¨ä¼˜åŒ–

### ğŸ”„ è¿›è¡Œä¸­
- [ ] æ›´æ™ºèƒ½çš„é¢„å–ç®—æ³•
- [ ] è‡ªé€‚åº”å‹ç¼©ç­–ç•¥
- [ ] æ›´å¤šå¹³å°æ”¯æŒ (x86_64 SIMD)

### ğŸ“‹ æœªæ¥è§„åˆ’
- [ ] åˆ†å¸ƒå¼ç‰ˆæœ¬
- [ ] æ›´é«˜çº§çš„æŸ¥è¯¢ä¼˜åŒ–
- [ ] é›†æˆæœºå™¨å­¦ä¹ ä¼˜åŒ–

## æŠ€æœ¯æ ˆ

- **æ ¸å¿ƒè¯­è¨€**: Rust 1.70+
- **åŸºç¡€æ¶æ„**: åŸºäº sled ä»£ç åº“
- **å¹¶å‘æ§åˆ¶**: concurrent-map, parking_lot
- **SIMD ä¼˜åŒ–**: std::arch::aarch64
- **å‹ç¼©**: zstd
- **æµ‹è¯•**: criterion, tokio-test

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

---

> "æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œéœ€è¦æ·±å…¥ç†è§£ç³»ç»Ÿåº•å±‚å’Œç²¾å¿ƒè®¾è®¡æ¯ä¸€ä¸ªç»†èŠ‚" - Melange DB å¼€å‘å›¢é˜Ÿ