# Melange DB ğŸª

> åŸºäº sled æ¶æ„æ·±åº¦ä¼˜åŒ–çš„ä¸‹ä¸€ä»£é«˜æ€§èƒ½åµŒå…¥å¼æ•°æ®åº“

[![Crates.io](https://img.shields.io/crates/v/melange_db.svg)](https://crates.io/crates/melange_db)
[![Documentation](https://docs.rs/melange_db/badge.svg)](https://docs.rs/melange_db)
[![License](https://img.shields.io/badge/license-LGPLv3-blue.svg)](https://www.gnu.org/licenses/lgpl-3.0.en.html)

## ğŸŒ è¯­è¨€ç‰ˆæœ¬
- [ä¸­æ–‡ç‰ˆ](README.md) | [English](README_en.md) | [æ—¥æœ¬èªç‰ˆ](README_ja.md)

## é¡¹ç›®ç®€ä»‹

Melange DB æ˜¯ä¸€ä¸ªåŸºäº sled æ¶æ„è¿›è¡Œæ·±åº¦æ€§èƒ½ä¼˜åŒ–çš„åµŒå…¥å¼æ•°æ®åº“ï¼Œä¸“æ³¨äºè¶…è¶Š RocksDB çš„æ€§èƒ½è¡¨ç°ã€‚é€šè¿‡ SIMD æŒ‡ä»¤ä¼˜åŒ–ã€æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿå’Œå¸ƒéš†è¿‡æ»¤å™¨ç­‰æŠ€æœ¯ï¼Œå®ç°æè‡´çš„è¯»å†™æ€§èƒ½ã€‚

### ğŸ­ åˆ›æ„æ¥æº

é¡¹ç›®åç§°å’Œè®¾è®¡ç†å¿µæ·±å—å¼—å…°å…‹Â·èµ«ä¼¯ç‰¹çš„ç»å…¸ç§‘å¹»å°è¯´ã€Šæ²™ä¸˜ã€‹(Dune) å¯å‘ï¼š

- **Melange (ç¾ç…è„‚)**: æ²™ä¸˜å®‡å®™ä¸­æœ€çè´µçš„ç‰©è´¨ï¼Œæ˜¯å®‡å®™èˆªè¡Œçš„å…³é”®ï¼Œè±¡å¾ç€æ•°æ®çš„çè´µå’Œä»·å€¼
- **ææƒ§æ˜¯æ€ç»´æ€æ‰‹**: æ­£å¦‚æ²™ä¸˜ä¸­çš„ç»å…¸å°è¯ "I must not fear. Fear is the mind-killer"ï¼Œæˆ‘ä»¬çš„è®¾è®¡å“²å­¦æ˜¯æ¶ˆé™¤å¯¹æ€§èƒ½çš„ææƒ§ï¼Œè¿½æ±‚æè‡´ä¼˜åŒ–
- **é¦™æ–™ä¹‹è·¯**: å¦‚åŒæ²™ä¸˜ä¸­çš„é¦™æ–™è¿è¾“è·¯çº¿ï¼ŒMelange DB æ„å»ºäº†é«˜æ•ˆçš„æ•°æ®æµå’Œå­˜å‚¨è·¯å¾„
- **å¼—é›·æ›¼äººç²¾ç¥**: æ²™æ¼ ä¸­çš„ç”Ÿå­˜ä¸“å®¶ï¼Œä»£è¡¨ç€åœ¨èµ„æºå—é™ç¯å¢ƒä¸‹çš„æè‡´æ€§èƒ½ä¼˜åŒ–

è¿™ç§çµæ„Ÿæ¥æºåæ˜ äº†æˆ‘ä»¬å¯¹æ•°æ®åº“è®¾è®¡çš„æ ¸å¿ƒç†å¿µï¼š**åœ¨æœ‰é™çš„èµ„æºä¸­åˆ›é€ æ— é™çš„ä»·å€¼**ã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸš€ æè‡´æ€§èƒ½ä¼˜åŒ–
- **SIMD ä¼˜åŒ–çš„ Key æ¯”è¾ƒ**: åŸºäº ARM64 NEON æŒ‡ä»¤é›†çš„é«˜æ€§èƒ½æ¯”è¾ƒ
- **å¤šçº§å—ç¼“å­˜ç³»ç»Ÿ**: çƒ­/æ¸©/å†·ä¸‰çº§ç¼“å­˜ï¼ŒLRU æ·˜æ±°ç­–ç•¥
- **æ™ºèƒ½å¸ƒéš†è¿‡æ»¤å™¨**: 1% è¯¯åˆ¤ç‡ï¼Œå¿«é€Ÿè¿‡æ»¤ä¸å­˜åœ¨æŸ¥è¯¢
- **é¢„å–æœºåˆ¶**: æ™ºèƒ½é¢„å–ç®—æ³•æå‡é¡ºåºè®¿é—®æ€§èƒ½

### ğŸ”’ å¹¶å‘å®‰å…¨
- **æ— é”æ•°æ®ç»“æ„**: åŸºäº concurrent-map çš„é«˜å¹¶å‘è®¾è®¡
- **çº¿ç¨‹å®‰å…¨**: å®Œå…¨çš„ Send + Sync trait å®ç°
- **åŸå­æ€§ä¿è¯**: ACID å…¼å®¹çš„äº‹åŠ¡æ”¯æŒ

### ğŸ“¦ é«˜æ•ˆå†…å­˜ç®¡ç†
- **å¢é‡åºåˆ—åŒ–**: å‡å°‘ IO å¼€é”€çš„åºåˆ—åŒ–ç­–ç•¥
- **æ™ºèƒ½ç¼“å­˜ç­–ç•¥**: è‡ªé€‚åº”ç¼“å­˜æ›¿æ¢ç®—æ³•
- **å†…å­˜æ˜ å°„ä¼˜åŒ–**: é«˜æ•ˆçš„æ–‡ä»¶æ˜ å°„æœºåˆ¶

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```rust
use melange_db::{Db, Config};

fn main() -> anyhow::Result<()> {
    // é…ç½®æ•°æ®åº“
    let config = Config::new()
        .path("/path/to/database")
        .cache_capacity_bytes(512 * 1024 * 1024); // 512MB ç¼“å­˜

    // æ‰“å¼€æ•°æ®åº“
    let db: Db<1024> = config.open()?;

    // å†™å…¥æ•°æ®
    let tree = db.open_tree("my_tree")?;
    tree.insert(b"key", b"value")?;

    // è¯»å–æ•°æ®
    if let Some(value) = tree.get(b"key")? {
        println!("Found value: {:?}", value);
    }

    // èŒƒå›´æŸ¥è¯¢
    for kv in tree.range(b"start"..b"end") {
        let (key, value) = kv?;
        println!("{}: {:?}", String::from_utf8_lossy(&key), value);
    }

    Ok(())
}
```

### å‹ç¼©é…ç½®

Melange DB æ”¯æŒé€šè¿‡ç¼–è¯‘æ—¶ç‰¹æ€§é€‰æ‹©å‹ç¼©ç®—æ³•ï¼Œä»¥é€‚åº”ä¸åŒçš„æ€§èƒ½éœ€æ±‚ï¼š

#### æ— å‹ç¼©æ¨¡å¼ï¼ˆé»˜è®¤ï¼Œæœ€ä½³æ€§èƒ½ï¼‰
```rust
use melange_db::{Db, Config, CompressionAlgorithm};

fn main() -> anyhow::Result<()> {
    // æ— å‹ç¼©é…ç½® - è¿½æ±‚æè‡´æ€§èƒ½
    let config = Config::new()
        .path("/path/to/database")
        .compression_algorithm(CompressionAlgorithm::None)  // æ— å‹ç¼©
        .cache_capacity_bytes(512 * 1024 * 1024); // 512MB ç¼“å­˜

    let db: Db<1024> = config.open()?;

    // è¯»å†™æ“ä½œå°†è·å¾—æœ€ä½³æ€§èƒ½ï¼Œæ— å‹ç¼©å¼€é”€
    let tree = db.open_tree("high_performance_tree")?;
    tree.insert(b"key", b"value")?;

    Ok(())
}
```

#### LZ4å‹ç¼©æ¨¡å¼ï¼ˆå¹³è¡¡æ€§èƒ½ä¸å‹ç¼©ç‡ï¼‰
```rust
use melange_db::{Db, Config, CompressionAlgorithm};

fn main() -> anyhow::Result<()> {
    // LZ4å‹ç¼©é…ç½® - å¹³è¡¡æ€§èƒ½å’Œå­˜å‚¨æ•ˆç‡
    let config = Config::new()
        .path("/path/to/database")
        .compression_algorithm(CompressionAlgorithm::Lz4)  // LZ4å‹ç¼©
        .cache_capacity_bytes(512 * 1024 * 1024); // 512MB ç¼“å­˜

    let db: Db<1024> = config.open()?;

    // è·å¾—è‰¯å¥½çš„å‹ç¼©ç‡ï¼ŒåŒæ—¶ä¿æŒè¾ƒé«˜æ€§èƒ½
    let tree = db.open_tree("balanced_tree")?;
    tree.insert(b"key", b"value")?;

    Ok(())
}
```

#### Zstdå‹ç¼©æ¨¡å¼ï¼ˆé«˜å‹ç¼©ç‡ï¼‰
```rust
use melange_db::{Db, Config, CompressionAlgorithm};

fn main() -> anyhow::Result<()> {
    // Zstdå‹ç¼©é…ç½® - è¿½æ±‚æœ€å¤§å‹ç¼©ç‡
    let config = Config::new()
        .path("/path/to/database")
        .compression_algorithm(CompressionAlgorithm::Zstd)  // Zstdå‹ç¼©
        .cache_capacity_bytes(512 * 1024 * 1024); // 512MB ç¼“å­˜

    let db: Db<1024> = config.open()?;

    // è·å¾—æœ€é«˜çš„å‹ç¼©ç‡ï¼Œé€‚åˆå­˜å‚¨å—é™åœºæ™¯
    let tree = db.open_tree("storage_efficient_tree")?;
    tree.insert(b"key", b"value")?;

    Ok(())
}
```

#### ç‰¹æ€§é€‰æ‹©å’ŒéªŒè¯
```rust
use melange_db::config::CompressionAlgorithm;

fn main() -> anyhow::Result<()> {
    // æ£€æŸ¥å¯ç”¨çš„å‹ç¼©ç‰¹æ€§
    let features = CompressionAlgorithm::detect_enabled_features();
    println!("å¯ç”¨çš„å‹ç¼©ç‰¹æ€§: {:?}", features);

    // éªŒè¯ç‰¹æ€§é…ç½®
    if let Some(warning) = CompressionAlgorithm::validate_feature_config() {
        println!("è­¦å‘Š: {}", warning);
    }

    // è·å–å®é™…ä½¿ç”¨çš„ç®—æ³•
    let (algorithm, reason) = CompressionAlgorithm::get_active_algorithm_with_reason();
    println!("ä½¿ç”¨å‹ç¼©ç®—æ³•: {:?}, åŸå› : {}", algorithm, reason);

    Ok(())
}
```

### æœ€ä½³å®è·µé…ç½®

```rust
use melange_db::{Db, Config};

fn main() -> anyhow::Result<()> {
    // ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
    let mut config = Config::new()
        .path("/path/to/database")
        .cache_capacity_bytes(1024 * 1024 * 1024) // 1GB ç¼“å­˜
        .flush_every_ms(Some(1000)); // 1ç§’ flush é—´éš”

    // å¯ç”¨æ™ºèƒ½ flush ç­–ç•¥
    config.smart_flush_config.enabled = true;
    config.smart_flush_config.base_interval_ms = 1000;
    config.smart_flush_config.min_interval_ms = 100;
    config.smart_flush_config.max_interval_ms = 5000;
    config.smart_flush_config.write_rate_threshold = 5000;
    config.smart_flush_config.accumulated_bytes_threshold = 8 * 1024 * 1024; // 8MB

    let db: Db<1024> = config.open()?;

    // ä½¿ç”¨æœ‰æ„ä¹‰çš„æ ‘å
    let users_tree = db.open_tree("users")?;
    let sessions_tree = db.open_tree("sessions")?;

    Ok(())
}
```

## ç¤ºä¾‹ä»£ç 

æˆ‘ä»¬æä¾›äº†å¤šä¸ªç¤ºä¾‹æ¥å¸®åŠ©æ‚¨æ›´å¥½åœ°ä½¿ç”¨ Melange DBï¼š

### ğŸ“Š æ€§èƒ½æµ‹è¯•ç¤ºä¾‹
- **`performance_demo.rs`** - åŸºæœ¬æ€§èƒ½æ¼”ç¤ºå’Œæ™ºèƒ½ flush ç­–ç•¥å±•ç¤º
- **`accurate_timing_demo.rs`** - ç²¾ç¡®è®¡æ—¶åˆ†æï¼ŒåŒ…å« P50/P95/P99 ç»Ÿè®¡

### ğŸ¯ æœ€ä½³å®è·µç¤ºä¾‹
- **`best_practices.rs`** - å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç¤ºä¾‹ï¼ŒåŒ…å«ï¼š
  - ç”¨æˆ·æ•°æ®ç®¡ç†
  - ä¼šè¯å¤„ç†
  - äº‹åŠ¡æ“ä½œ
  - æ‰¹é‡æ’å…¥
  - èŒƒå›´æŸ¥è¯¢
  - æ•°æ®æ¸…ç†

### âš ï¸ é‡è¦è¯´æ˜

**ç¤ºä¾‹ä»£ç ä¼˜åŒ–ç›®æ ‡**: å½“å‰ç¤ºä¾‹ä¸»è¦é’ˆå¯¹ Apple M1 ç­‰é«˜ç«¯ ARM64 è®¾å¤‡ä¼˜åŒ–ï¼Œé…ç½®äº†è¾ƒå¤§çš„ç¼“å­˜ï¼ˆ1GBï¼‰å’Œé€‚ç”¨äºé«˜æ€§èƒ½åœºæ™¯çš„å‚æ•°ã€‚

**ä½ç«¯è®¾å¤‡ä¼˜åŒ–å»ºè®®**: å¦‚æœæ‚¨éœ€è¦åœ¨ Intel Celeron J1800 ç­‰ä½ç«¯ x86 è®¾å¤‡ä¸Šè¿è¡Œï¼Œè¯·å‚è€ƒï¼š
- **æµ‹è¯•æ–‡ä»¶**: `tests/low_end_x86_perf_test.rs`
- **ä¸“ç”¨é…ç½®**: é’ˆå¯¹ 2GB å†…å­˜å’Œ SSE2 æŒ‡ä»¤é›†ä¼˜åŒ–
- **æ€§èƒ½ç›®æ ‡**: å†™å…¥ 9-15 Âµs/æ¡ï¼Œè¯»å– 2-5 Âµs/æ¡

### è¿è¡Œç¤ºä¾‹

```bash
# è¿è¡ŒåŸºæœ¬æ€§èƒ½æ¼”ç¤º
cargo run --example performance_demo

# è¿è¡Œç²¾ç¡®è®¡æ—¶åˆ†æ
cargo run --example accurate_timing_demo

# è¿è¡Œæœ€ä½³å®è·µç¤ºä¾‹
cargo run --example best_practices

# è¿è¡Œå‹ç¼©ç®—æ³•æ€§èƒ½å¯¹æ¯”ï¼ˆéœ€è¦æŒ‡å®šå‹ç¼©ç‰¹æ€§ï¼‰
cargo run --example macbook_air_m1_compression_none --features compression-none --release
cargo run --example macbook_air_m1_compression_lz4 --features compression-lz4 --release
cargo run --example macbook_air_m1_compression_zstd --features compression-zstd --release
```

### ä½ç«¯è®¾å¤‡é…ç½®å‚è€ƒ

```rust
// é’ˆå¯¹ Intel Celeron J1800 + 2GB å†…å­˜çš„ä¼˜åŒ–é…ç½®
let mut config = Config::new()
    .path("low_end_db")
    .flush_every_ms(None)  // ç¦ç”¨ä¼ ç»Ÿè‡ªåŠ¨flushï¼Œä½¿ç”¨æ™ºèƒ½flush
    .cache_capacity_bytes(32 * 1024 * 1024);  // 32MBç¼“å­˜ï¼Œé€‚åº”2GBå†…å­˜

// ä¼˜åŒ–æ™ºèƒ½flushé…ç½®
config.smart_flush_config = crate::smart_flush::SmartFlushConfig {
    enabled: true,
    base_interval_ms: 100,     // 100msåŸºç¡€é—´éš”
    min_interval_ms: 30,        // 30msæœ€å°é—´éš”
    max_interval_ms: 1500,     // 1.5sæœ€å¤§é—´éš”
    write_rate_threshold: 4000, // 4K ops/secé˜ˆå€¼
    accumulated_bytes_threshold: 2 * 1024 * 1024, // 2MBç´¯ç§¯é˜ˆå€¼
};
```

### ç¤ºä¾‹äº®ç‚¹

âœ… **é…ç½®ä¼˜åŒ–**: å±•ç¤ºå¦‚ä½•æ ¹æ®åº”ç”¨åœºæ™¯è°ƒæ•´ç¼“å­˜å’Œ flush å‚æ•°
âœ… **æ•°æ®å»ºæ¨¡**: æ¼”ç¤ºç»“æ„åŒ–æ•°æ®çš„å­˜å‚¨å’ŒæŸ¥è¯¢æ¨¡å¼
âœ… **æ‰¹é‡æ“ä½œ**: ä»‹ç»é«˜æ•ˆçš„æ•°æ®æ’å…¥å’Œå¤„ç†æŠ€å·§
âœ… **æŸ¥è¯¢ä¼˜åŒ–**: å±•ç¤ºèŒƒå›´æŸ¥è¯¢å’Œå‰ç¼€æŸ¥è¯¢çš„æœ€ä½³å®è·µ
âœ… **äº‹åŠ¡å¤„ç†**: æ¼”ç¤ºå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§
âœ… **æ€§èƒ½ç›‘æ§**: æä¾›æ€§èƒ½ç»Ÿè®¡å’Œç›‘æ§å»ºè®®

## æ€§èƒ½è¡¨ç°

### æ€§èƒ½æµ‹è¯•æ•°æ®

è¯¦ç»†çš„æ€§èƒ½æµ‹è¯•æ•°æ®å’Œç¡¬ä»¶ç¯å¢ƒä¿¡æ¯è¯·æŸ¥çœ‹ï¼š[docs/test_data/index.md](docs/test_data/index.md)

### æ€§èƒ½äº®ç‚¹

- **é«˜ç«¯è®¾å¤‡è¡¨ç°**: åœ¨Apple M1ä¸Šè¾¾åˆ°å†™å…¥1.23 Âµs/æ¡ï¼Œè¯»å–0.42 Âµs/æ¡çš„ä¼˜å¼‚æ€§èƒ½
- **ä½ç«¯è®¾å¤‡ä¼˜åŒ–**: åœ¨Intel Celeron J1800ä¸Šé€šè¿‡æ™ºèƒ½flushä¼˜åŒ–å®ç°å†™å…¥9.13 Âµs/æ¡ï¼Œè¯»å–2.56 Âµs/æ¡
- **ä½åŠŸè€—è®¾å¤‡é€‚é…**: åœ¨æ ‘è“æ´¾3B+ä¸Šå®ç°å†™å…¥39.04 Âµs/æ¡ï¼Œè¯»å–9.06 Âµs/æ¡ï¼ŒæˆåŠŸé€‚é…1GBå†…å­˜+SDå¡å­˜å‚¨ç¯å¢ƒ
- **å¯¹æ¯”ä¼˜åŠ¿**: ç›¸æ¯”RocksDBæœ€é«˜æå‡4å€å†™å…¥æ€§èƒ½
- **è·¨å¹³å°æ”¯æŒ**: ä¼˜åŒ–äº†ARM64å’Œx86_64æ¶æ„çš„æ€§èƒ½è¡¨ç°

### æµ‹è¯•è¦†ç›–

- **ç¡¬ä»¶å¤šæ ·æ€§**: ä»é«˜ç«¯Apple M1ã€ä½ç«¯Intel Celeronåˆ°æ ‘è“æ´¾3B+çš„å®Œæ•´æµ‹è¯•è¦†ç›–
- **ç³»ç»Ÿå…¼å®¹**: macOSå’ŒLinuxå¤šå¹³å°éªŒè¯
- **ä¼˜åŒ–éªŒè¯**: SIMDæŒ‡ä»¤é›†ã€æ™ºèƒ½flushã€ç¼“å­˜ç­–ç•¥ç­‰å¤šç»´åº¦ä¼˜åŒ–æ•ˆæœéªŒè¯
- **æŒç»­æµ‹è¯•**: å®šæœŸæ€§èƒ½å›å½’æµ‹è¯•ç¡®ä¿æ€§èƒ½ç¨³å®šæ€§

## ä¼˜åŒ–æŠ€æœ¯è¯¦è§£

### 1. SIMD ä¼˜åŒ–
- **å¤šå¹³å°æ”¯æŒ**: åŒæ—¶æ”¯æŒ ARM64 NEON å’Œ x86_64 SSE2/AVX2 æŒ‡ä»¤é›†
- **ARM64 NEON**: æ”¯æŒ Apple M1 å’Œæ ‘è“æ´¾ 3b+ ç­‰ARM64è®¾å¤‡
- **x86_64 SSE2**: æ”¯æŒIntel Celeronç­‰ä¸æ”¯æŒAVX2çš„ä½ç«¯x86è®¾å¤‡
- **x86_64 AVX2**: æ”¯æŒç°ä»£Intel/AMDå¤„ç†å™¨ï¼Œ32å­—èŠ‚å‘é‡å¤„ç†
- **è‡ªé€‚åº”æ£€æµ‹**: è¿è¡Œæ—¶è‡ªåŠ¨æ£€æµ‹CPUæ”¯æŒçš„æŒ‡ä»¤é›†å¹¶é€‰æ‹©æœ€ä¼˜å®ç°
- **å°keyä¼˜åŒ–**: é’ˆå¯¹â‰¤16å­—èŠ‚çš„keyä½¿ç”¨å¿«é€Ÿ64ä½æ•´æ•°æ¯”è¾ƒ
- **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡keyæ¯”è¾ƒæ“ä½œï¼Œæå‡ç¼“å­˜å‘½ä¸­ç‡
- **é™çº§ç­–ç•¥**: ä¸æ”¯æŒSIMDæ—¶ä½¿ç”¨ä¼˜åŒ–çš„æ ‡é‡æ¯”è¾ƒç®—æ³•

### 2. å¸ƒéš†è¿‡æ»¤å™¨
- **å¤šçº§è¿‡æ»¤å™¨**: æ”¯æŒçƒ­/æ¸©/å†·æ•°æ®åˆ†å±‚
- **å¯é…ç½®è¯¯åˆ¤ç‡**: é»˜è®¤ 1%ï¼Œå¯æŒ‰éœ€è°ƒæ•´
- **å¹¶å‘å®‰å…¨**: æ”¯æŒå¤šçº¿ç¨‹åŒæ—¶è®¿é—®

### 3. å—ç¼“å­˜ç³»ç»Ÿ
- **ä¸‰çº§ç¼“å­˜æ¶æ„**: çƒ­/æ¸©/å†·æ•°æ®åˆ†å±‚å­˜å‚¨
- **æ™ºèƒ½é¢„å–**: åŸºäºè®¿é—®æ¨¡å¼çš„é¢„å–ç®—æ³•
- **å‹ç¼©æ”¯æŒ**: è‡ªåŠ¨å‹ç¼©å¤§å—æ•°æ®
- **100% å‘½ä¸­ç‡**: åœ¨æµ‹è¯•åœºæ™¯ä¸‹çš„å®Œç¾è¡¨ç°

## æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

1. **Tree**: B+ æ ‘ç´¢å¼•ç»“æ„ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢
2. **Leaf**: å¶å­èŠ‚ç‚¹ï¼Œå­˜å‚¨å®é™…æ•°æ®
3. **ObjectCache**: å¯¹è±¡ç¼“å­˜ç³»ç»Ÿï¼Œé›†æˆä¼˜åŒ–ç»„ä»¶
4. **Heap**: å †ç®¡ç†å™¨ï¼Œè´Ÿè´£å†…å­˜åˆ†é…
5. **Index**: å¹¶å‘ç´¢å¼•ï¼Œæ”¯æŒé«˜å¹¶å‘è®¿é—®

### ä¼˜åŒ–é›†æˆ

- **é€æ˜ä¼˜åŒ–**: ç”¨æˆ·æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç å³å¯è·å¾—æ€§èƒ½æå‡
- **å‘åå…¼å®¹**: å®Œå…¨å…¼å®¹ sled çš„ API è®¾è®¡
- **æ¸è¿›å¼ä¼˜åŒ–**: å¯ä»¥é€‰æ‹©æ€§å¯ç”¨ç‰¹å®šä¼˜åŒ–åŠŸèƒ½

## é€‚ç”¨åœºæ™¯

- **é«˜é¢‘äº¤æ˜“ç³»ç»Ÿ**: ä½å»¶è¿Ÿè¯»å†™éœ€æ±‚
- **å®æ—¶æ•°æ®åˆ†æ**: é«˜ååé‡æ•°æ®å¤„ç†
- **åµŒå…¥å¼è®¾å¤‡**: èµ„æºå—é™ç¯å¢ƒä¸‹çš„é«˜æ€§èƒ½å­˜å‚¨
- **ç¼“å­˜ç³»ç»Ÿ**: ä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜çš„åç«¯å­˜å‚¨

## æœ€ä½³å®è·µæŒ‡å—

### ğŸ¯ é…ç½®ä¼˜åŒ–

1. **ç¼“å­˜å¤§å°è®¾ç½®**
   - å°å‹åº”ç”¨/ä½ç«¯è®¾å¤‡: 32MB - 256MB
   - ä¸­å‹åº”ç”¨: 512MB - 1GB
   - å¤§å‹åº”ç”¨/é«˜æ€§èƒ½è®¾å¤‡: 2GB - 4GB+

2. **æ™ºèƒ½ Flush ç­–ç•¥**
   - å¯ç”¨æ™ºèƒ½ flush ä»¥å¹³è¡¡æ€§èƒ½å’Œæ•°æ®å®‰å…¨
   - æ ¹æ®å†™å…¥è´Ÿè½½è°ƒæ•´ flush é—´éš”
   - è®¾ç½®åˆç†çš„ç´¯ç§¯å­—èŠ‚é˜ˆå€¼
   - **ä½ç«¯è®¾å¤‡ä¼˜åŒ–**: å‡å°‘åŸºç¡€é—´éš”ï¼Œæé«˜é¢‘ç‡ï¼Œé™ä½ç´¯ç§¯é˜ˆå€¼
   - **æ ‘è“æ´¾3B+ç‰¹æ®Šä¼˜åŒ–**: å¢åŠ flushé—´éš”åˆ°200msï¼Œé™ä½å†™å…¥é˜ˆå€¼åˆ°2000 ops/secï¼Œé€‚åº”SDå¡å­˜å‚¨ç‰¹æ€§

3. **æ ‘çš„è®¾è®¡**
   - ä½¿ç”¨æœ‰æ„ä¹‰çš„æ ‘å
   - åˆç†è®¾è®¡é”®çš„å‰ç¼€ç»“æ„
   - é¿å…å•ä¸ªæ ‘è¿‡å¤§

4. **ç¡¬ä»¶é€‚é…å»ºè®®**
   - **é«˜ç«¯è®¾å¤‡ (Apple M1ç­‰)**: ä½¿ç”¨ç¤ºä¾‹ä¸­çš„1GBç¼“å­˜é…ç½®
   - **ä½ç«¯è®¾å¤‡ (Intel Celeronç­‰)**: å‚è€ƒ `tests/low_end_x86_perf_test.rs` é…ç½®
   - **æ ‘è“æ´¾3B+ç­‰ä½åŠŸè€—ARMè®¾å¤‡**: å‚è€ƒ `tests/raspberry_pi_perf_test.rs` é…ç½®
   - **å†…å­˜å—é™ç¯å¢ƒ**: å‡å°‘ç¼“å­˜å¤§å°ï¼Œä¼˜åŒ–flushç­–ç•¥ï¼Œè€ƒè™‘ä½¿ç”¨å¢é‡åºåˆ—åŒ–

### ğŸ“Š æ€§èƒ½ä¼˜åŒ–

1. **æ‰¹é‡æ“ä½œ**
   - å¤§é‡æ•°æ®æ’å…¥ä½¿ç”¨æ‰¹é‡æ“ä½œ
   - é¿å…é¢‘ç¹çš„å•æ¡æ’å…¥
   - åˆ©ç”¨é¢„çƒ­ä¼˜åŒ–æ€§èƒ½

2. **æŸ¥è¯¢ä¼˜åŒ–**
   - ä½¿ç”¨èŒƒå›´æŸ¥è¯¢è·å–è¿ç»­æ•°æ®
   - åˆ©ç”¨å‰ç¼€æŸ¥è¯¢è¿‡æ»¤æ•°æ®
   - é¿å…å…¨è¡¨æ‰«æ

3. **æ•°æ®ç®¡ç†**
   - å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
   - ä½¿ç”¨äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§
   - ç›‘æ§æ•°æ®åº“å¤§å°å’Œæ€§èƒ½

### ğŸ”§ å¼€å‘å»ºè®®

1. **å¼€å‘ç¯å¢ƒ**
   - ä½¿ç”¨è¾ƒå°çš„ç¼“å­˜å¤§å°è¿›è¡Œå¼€å‘
   - å¯ç”¨è°ƒè¯•æ—¥å¿—ç›‘æ§æ€§èƒ½
   - å®šæœŸè¿›è¡Œæ€§èƒ½æµ‹è¯•

2. **ç”Ÿäº§ç¯å¢ƒ**
   - æ ¹æ®å®é™…è´Ÿè½½è°ƒæ•´é…ç½®å‚æ•°
   - ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡
   - å»ºç«‹æ•°æ®å¤‡ä»½æœºåˆ¶

3. **æµ‹è¯•ç­–ç•¥**
   - è¿›è¡Œå‹åŠ›æµ‹è¯•éªŒè¯æ€§èƒ½
   - æµ‹è¯•æ•…éšœæ¢å¤èƒ½åŠ›
   - éªŒè¯æ•°æ®ä¸€è‡´æ€§

## å¼€å‘è·¯çº¿

### âœ… å·²å®Œæˆä¼˜åŒ–
- [x] SIMD ä¼˜åŒ–çš„ key æ¯”è¾ƒ
- [x] å¤šçº§å¸ƒéš†è¿‡æ»¤å™¨
- [x] æ™ºèƒ½å—ç¼“å­˜ç³»ç»Ÿ
- [x] å¢é‡åºåˆ—åŒ–ä¼˜åŒ–
- [x] å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- [x] æ™ºèƒ½è‡ªé€‚åº” flush ç­–ç•¥
- [x] å®Œæ•´çš„ç¤ºä¾‹ä»£ç å’Œæ–‡æ¡£
- [x] æ™ºèƒ½é¢„å–ç®—æ³•ï¼ˆåŸºäºè®¿é—®æ¨¡å¼ï¼‰
- [x] å®Œæ•´çš„å¤šå¹³å°SIMDæ”¯æŒï¼ˆARM64 NEON + x86_64 SSE2/AVX2ï¼‰
- [x] LZ4å‹ç¼©ç®—æ³•æ”¯æŒï¼ˆç‰¹æ€§å¯é€‰ï¼Œæä¾›æ›´å¿«çš„å‹ç¼©é€Ÿåº¦ï¼‰
- [x] å¤šå‹ç¼©ç®—æ³•ç‰¹æ€§é€‰æ‹©ï¼ˆæ— å‹ç¼©/LZ4/Zstdï¼Œç¼–è¯‘æ—¶ç‰¹æ€§æ§åˆ¶ï¼‰
- [x] å‹ç¼©ç®—æ³•æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•æ•°æ®æ”¶é›†
- [x] Apple Silicon M1ä¸“é¡¹ä¼˜åŒ–å’Œæ€§èƒ½éªŒè¯

### ğŸ”„ è¿›è¡Œä¸­
- [ ] è‡ªé€‚åº”å‹ç¼©ç­–ç•¥ï¼ˆè¿è¡Œæ—¶æ ¹æ®æ•°æ®ç‰¹å¾é€‰æ‹©å‹ç¼©ç®—æ³•ï¼‰

### ğŸ“‹ ä¸‹ä¸€é˜¶æ®µå¼€å‘è®¡åˆ’ï¼ˆv0.2.0ï¼‰

#### ğŸ¯ æ€§èƒ½ä¼˜åŒ–
- [x] **è‡ªé€‚åº”å‹ç¼©ç­–ç•¥** - è¿è¡Œæ—¶æ ¹æ®æ•°æ®ç‰¹å¾è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜å‹ç¼©ç®—æ³•
- [ ] **çƒ­ç‚¹æ•°æ®è¯†åˆ«** - æ™ºèƒ½è¯†åˆ«é«˜é¢‘è®¿é—®æ•°æ®ï¼Œä¼˜åŒ–ç¼“å­˜ç­–ç•¥
- [ ] **å†…å­˜å‹ç¼©** - å¯¹å†·æ•°æ®è¿›è¡Œå†…å­˜å‹ç¼©ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡
- [ ] **IOä¼˜åŒ–** - å¼‚æ­¥IOæ”¯æŒï¼Œå‡å°‘é˜»å¡ç­‰å¾…æ—¶é—´
- [ ] **æ‰¹é‡æ“ä½œä¼˜åŒ–** - è¿›ä¸€æ­¥ä¼˜åŒ–æ‰¹é‡æ’å…¥å’ŒæŸ¥è¯¢æ€§èƒ½

#### ğŸ› ï¸ åŠŸèƒ½å¢å¼º
- [ ] **äº‹åŠ¡æ”¯æŒ** - å®Œæ•´çš„ACIDäº‹åŠ¡æ”¯æŒ
- [ ] **èŒƒå›´æŸ¥è¯¢ä¼˜åŒ–** - æ›´é«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢å’Œè¿­ä»£å™¨
- [ ] **äºŒçº§ç´¢å¼•** - æ”¯æŒåˆ›å»ºå’Œç®¡ç†äºŒçº§ç´¢å¼•
- [ ] **æ•°æ®TTL** - è‡ªåŠ¨è¿‡æœŸæ•°æ®æ¸…ç†
- [ ] **å¤‡ä»½æ¢å¤** - æ•°æ®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶

#### ğŸ”§ æ¶æ„æ”¹è¿›
- [ ] **æ’ä»¶ç³»ç»Ÿ** - å¯æ‰©å±•çš„æ’ä»¶æ¶æ„
- [ ] **é…ç½®ç®¡ç†** - æ›´çµæ´»çš„é…ç½®ç³»ç»Ÿ
- [ ] **ç›‘æ§æŒ‡æ ‡** - è¯¦ç»†çš„æ€§èƒ½ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†
- [ ] **æ—¥å¿—ç³»ç»Ÿ** - ç»“æ„åŒ–æ—¥å¿—å’Œå®¡è®¡åŠŸèƒ½

#### ğŸŒ å¹³å°æ”¯æŒ
- [ ] **Windowsä¼˜åŒ–** - Windowså¹³å°ä¸“é¡¹ä¼˜åŒ–
- [ ] **Androidæ”¯æŒ** - Androidå¹³å°é€‚é…
- [ ] **iOSæ”¯æŒ** - iOSå¹³å°é€‚é…
- [ ] **WebAssembly** - WASMæ”¯æŒï¼Œæµè§ˆå™¨ç¯å¢ƒä½¿ç”¨

#### ğŸ“Š å·¥å…·ç”Ÿæ€
- [ ] **CLIå·¥å…·** - å‘½ä»¤è¡Œç®¡ç†å·¥å…·
- [ ] **Webç•Œé¢** - åŸºäºWebçš„ç®¡ç†ç•Œé¢
- [ ] **æ€§èƒ½åˆ†æ** - æ€§èƒ½åˆ†æå’Œè°ƒä¼˜å·¥å…·
- [ ] **æ•°æ®è¿ç§»** - æ•°æ®å¯¼å…¥å¯¼å‡ºå·¥å…·

### ğŸš€ é•¿æœŸè§„åˆ’ï¼ˆv1.0+ï¼‰

#### åˆ†å¸ƒå¼ç‰ˆæœ¬
- [ ] **é›†ç¾¤æ”¯æŒ** - å¤šèŠ‚ç‚¹é›†ç¾¤éƒ¨ç½²
- [ ] **æ•°æ®åˆ†ç‰‡** - è‡ªåŠ¨æ•°æ®åˆ†ç‰‡å’Œè´Ÿè½½å‡è¡¡
- [ ] **æ•…éšœè½¬ç§»** - è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œè½¬ç§»
- [ ] **ä¸€è‡´æ€§åè®®** - åˆ†å¸ƒå¼ä¸€è‡´æ€§ä¿è¯

#### é«˜çº§æŸ¥è¯¢ä¼˜åŒ–
- [ ] **æŸ¥è¯¢è®¡åˆ’** - æ™ºèƒ½æŸ¥è¯¢è®¡åˆ’ä¼˜åŒ–
- [ ] **ç´¢å¼•ä¼˜åŒ–** - è‡ªé€‚åº”ç´¢å¼•ç­–ç•¥
- [ ] **ç¼“å­˜ç­–ç•¥** - å¤šçº§ç¼“å­˜ä¼˜åŒ–
- [ ] **é¢„è®¡ç®—** - æŸ¥è¯¢ç»“æœé¢„è®¡ç®—

#### æœºå™¨å­¦ä¹ é›†æˆ
- [ ] **è®¿é—®æ¨¡å¼é¢„æµ‹** - åŸºäºMLçš„è®¿é—®æ¨¡å¼é¢„æµ‹
- [ ] **è‡ªåŠ¨è°ƒä¼˜** - åŸºäºMLçš„å‚æ•°è‡ªåŠ¨è°ƒä¼˜
- [ ] **å¼‚å¸¸æ£€æµ‹** - æ•°æ®è®¿é—®å¼‚å¸¸æ£€æµ‹
- [ ] **å®¹é‡è§„åˆ’** - æ™ºèƒ½å®¹é‡è§„åˆ’å»ºè®®

## æŠ€æœ¯æ ˆ

### å¼€å‘ç¯å¢ƒ
- **æ ¸å¿ƒè¯­è¨€**: Rust 1.70+
- **åŸºç¡€æ¶æ„**: åŸºäº sled ä»£ç åº“
- **å¹¶å‘æ§åˆ¶**: concurrent-map, parking_lot
- **SIMD ä¼˜åŒ–**:
  - std::arch::aarch64 (ARM64 NEONæŒ‡ä»¤é›†)
  - std::arch::x86_64 (x86_64 SSE2/AVX2æŒ‡ä»¤é›†)
- **å‹ç¼©**: zstd, lz4_flexï¼ˆç‰¹æ€§å¯é€‰ï¼‰
- **æµ‹è¯•**: criterion, tokio-test

### å‹ç¼©ç®—æ³•é€‰æ‹©ï¼ˆç¼–è¯‘æ—¶ç‰¹æ€§ï¼‰

Melange DB æ”¯æŒé€šè¿‡ç¼–è¯‘æ—¶ç‰¹æ€§é€‰æ‹©å‹ç¼©ç®—æ³•ï¼Œä»¥é€‚åº”ä¸åŒçš„æ€§èƒ½éœ€æ±‚ï¼š

#### æ— å‹ç¼©ï¼ˆé»˜è®¤ï¼‰
```bash
cargo build --release
```
- **é€‚ç”¨åœºæ™¯**: ä½ç«¯è®¾å¤‡ï¼ˆå¦‚æ ‘è“æ´¾ï¼‰ã€è¿½æ±‚æè‡´æ€§èƒ½
- **ç‰¹ç‚¹**: é›¶CPUå¼€é”€ï¼Œæœ€å¿«è¯»å†™é€Ÿåº¦

#### LZ4å‹ç¼©
```bash
cargo build --release --features compression-lz4
```
- **é€‚ç”¨åœºæ™¯**: ä¸­ç­‰æ€§èƒ½è®¾å¤‡ï¼Œéœ€è¦è¾ƒå¥½çš„å‹ç¼©é€Ÿåº¦å’Œå‹ç¼©ç‡å¹³è¡¡
- **ç‰¹ç‚¹**: æå¿«çš„å‹ç¼©/è§£å‹ç¼©é€Ÿåº¦ï¼Œé€‚åº¦å‹ç¼©ç‡

#### Zstdå‹ç¼©
```bash
cargo build --release --features compression-zstd
```
- **é€‚ç”¨åœºæ™¯**: å­˜å‚¨ç©ºé—´å—é™ï¼Œéœ€è¦é«˜å‹ç¼©ç‡
- **ç‰¹ç‚¹**: é«˜å‹ç¼©ç‡ï¼Œä½†CPUå¼€é”€ç›¸å¯¹è¾ƒå¤§

#### ç‰¹æ€§ä¼˜å…ˆçº§
å¦‚æœåŒæ—¶å¯ç”¨å¤šä¸ªå‹ç¼©ç‰¹æ€§ï¼Œå°†æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§é€‰æ‹©ï¼š**none > lz4 > zstd**

#### é…ç½®éªŒè¯
```rust
use melange_db::config::CompressionAlgorithm;

// æ£€æŸ¥å¯ç”¨çš„å‹ç¼©ç‰¹æ€§
let features = CompressionAlgorithm::detect_enabled_features();
println!("å¯ç”¨çš„å‹ç¼©ç‰¹æ€§: {:?}", features);

// éªŒè¯ç‰¹æ€§é…ç½®
if let Some(warning) = CompressionAlgorithm::validate_feature_config() {
    println!("è­¦å‘Š: {}", warning);
}

// è·å–å®é™…ä½¿ç”¨çš„ç®—æ³•
let (algorithm, reason) = CompressionAlgorithm::get_active_algorithm_with_reason();
println!("ä½¿ç”¨å‹ç¼©ç®—æ³•: {:?}, åŸå› : {}", algorithm, reason);
```

### ç›®æ ‡å¹³å°
- **ARM64å¹³å°**: Apple M1, Raspberry Pi 3b+ ç­‰ARM64è®¾å¤‡
- **x86_64å¹³å°**: Intel/AMDå¤„ç†å™¨ï¼Œä»ä½ç«¯åˆ°é«˜ç«¯å…¨è¦†ç›–
- **ç¼–è¯‘ç›®æ ‡**:
  - aarch64-apple-darwin, aarch64-unknown-linux-gnu
  - x86_64-apple-darwin, x86_64-unknown-linux-gnu
- **æŒ‡ä»¤é›†æ”¯æŒ**:
  - ARM64: ARMv8.4-A with NEON SIMD
  - x86_64: SSE2 (åŸºç¡€), AVX2 (ç°ä»£å¤„ç†å™¨)
- **è¿è¡Œæ—¶æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹CPUç‰¹æ€§å¹¶é€‰æ‹©æœ€ä¼˜SIMDå®ç°

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ GNU Lesser General Public License v3.0 (LGPLv3) è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

### è®¸å¯è¯è¯´æ˜

é€‰æ‹© LGPLv3 çš„åŸå› ï¼š

- **å•†ä¸šå‹å¥½**: å…è®¸å°† Melange DB ç”¨äºå•†ä¸šè½¯ä»¶å’Œé—­æºé¡¹ç›®
- **åŠ¨æ€é“¾æ¥**: é€šè¿‡åŠ¨æ€é“¾æ¥æ–¹å¼ä½¿ç”¨æ—¶ï¼Œä¸»ç¨‹åºå¯ä»¥ä¿æŒé—­æº
- **å¼€æºä¹‰åŠ¡**: ä»…å¯¹åº“æœ¬èº«çš„ä¿®æ”¹éœ€è¦å¼€æºï¼Œä¸å½±å“ä½¿ç”¨æ–¹ä»£ç 
- **ç¤¾åŒºè´¡çŒ®**: ç¡®ä¿æ”¹è¿›å’Œä¼˜åŒ–èƒ½å¤Ÿå›é¦ˆç»™å¼€æºç¤¾åŒº

### ä½¿ç”¨åœºæ™¯

- âœ… **å•†ä¸šè½¯ä»¶**: å¯ä»¥åœ¨é—­æºå•†ä¸šè½¯ä»¶ä¸­ä½¿ç”¨
- âœ… **å¼€æºé¡¹ç›®**: å®Œå…¨å…¼å®¹å…¶ä»–å¼€æºè®¸å¯è¯
- âœ… **åŠ¨æ€é“¾æ¥**: æ¨èçš„ä½¿ç”¨æ–¹å¼ï¼Œä¸»ç¨‹åºä¿æŒé—­æº
- âœ… **ä¿®æ”¹è´¡çŒ®**: å¯¹ Melange DB çš„æ”¹è¿›éœ€è¦å¼€æº

## è‡´è°¢

- åŸºäºä¼˜ç§€çš„ [sled](https://github.com/spacejam/sled) æ•°æ®åº“æ¶æ„
- çµæ„Ÿæ¥è‡ªå¼—å…°å…‹Â·èµ«ä¼¯ç‰¹çš„ã€Šæ²™ä¸˜ã€‹å®‡å®™
- æ„Ÿè°¢æ‰€æœ‰æä¾›åé¦ˆå’Œå»ºè®®çš„è´¡çŒ®è€…å’Œç”¨æˆ·

> "I must not fear. Fear is the mind-killer." - Frank Herbert, Dune