# Melange DB ğŸª

> sledã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åŸºã¥ãæ¬¡ä¸–ä»£é«˜æ€§èƒ½çµ„ã¿è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

[![Crates.io](https://img.shields.io/crates/v/melange_db.svg)](https://crates.io/crates/melange_db)
[![Documentation](https://docs.rs/melange_db/badge.svg)](https://docs.rs/melange_db)
[![License](https://img.shields.io/badge/license-LGPLv3-blue.svg)](https://www.gnu.org/licenses/lgpl-3.0.en.html)

## ğŸŒ è¨€èªãƒãƒ¼ã‚¸ãƒ§ãƒ³
- [ä¸­æ–‡ç‰ˆ](README.md) | [English](README_en.md) | [æ—¥æœ¬èªç‰ˆ](README_ja.md)

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç´¹ä»‹

Melange DBã¯ã€sledã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ãƒ™ãƒ¼ã‚¹ã«æ·±ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚’è¡Œã£ãŸçµ„ã¿è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã™ã€‚RocksDBã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è¶…è¶Šã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã€SIMDå‘½ä»¤æœ€é©åŒ–ã€ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ ã€ãƒ–ãƒ«ãƒ¼ãƒ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãªã©ã®æŠ€è¡“ã«ã‚ˆã‚Šã€ç©¶æ¥µã®èª­ã¿æ›¸ããƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

### ğŸ­ å‰µä½œã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¨è¨­è¨ˆå“²å­¦ã¯ã€ãƒ•ãƒ©ãƒ³ã‚¯ãƒ»ãƒãƒ¼ãƒãƒ¼ãƒˆã®å¤å…¸SFå°èª¬ã€Œãƒ‡ãƒ¥ãƒ¼ãƒ³ã€ã«æ·±ãã‚¤ãƒ³ã‚¹ãƒ‘ã‚¤ã‚¢ã•ã‚Œã¦ã„ã¾ã™ï¼š

- **ãƒ¡ãƒ©ãƒ³ã‚¸ãƒ¥ï¼ˆã‚¹ãƒ‘ã‚¤ã‚¹ï¼‰**: ãƒ‡ãƒ¥ãƒ¼ãƒ³å®‡å®™ã§æœ€ã‚‚è²´é‡ãªç‰©è³ªã€å®‡å®™èˆªè¡Œã®éµã§ã‚ã‚Šã€ãƒ‡ãƒ¼ã‚¿ã®ä¾¡å€¤ã‚’è±¡å¾´
- **ææ€–ã¯æ€è€ƒæ®ºã—**: ã€Œææ€–ã¯å¿ƒã®æ®ºã—å±‹ã ã€ã¨ã„ã†å¤å…¸çš„ãªã‚»ãƒªãƒ•ã®ã‚ˆã†ã«ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®ææ€–ã‚’æ’é™¤ã—ã€ç©¶æ¥µã®æœ€é©åŒ–ã‚’è¿½æ±‚
- **ã‚¹ãƒ‘ã‚¤ã‚¹ãƒ«ãƒ¼ãƒˆ**: ãƒ‡ãƒ¥ãƒ¼ãƒ³ã®ã‚¹ãƒ‘ã‚¤ã‚¹è¼¸é€ãƒ«ãƒ¼ãƒˆã®ã‚ˆã†ã«ã€Melange DBã¯åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‘ã‚¹ã‚’æ§‹ç¯‰
- **ãƒ•ãƒªãƒ¼ãƒ¡ãƒ³ã®ç²¾ç¥**: ç ‚æ¼ ã®ã‚µãƒã‚¤ãƒãƒ«å°‚é–€å®¶ã€ãƒªã‚½ãƒ¼ã‚¹åˆ¶ç´„ç’°å¢ƒã§ã®ç©¶æ¥µã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚’è¡¨ç¾

ã“ã®ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ç§ãŸã¡ã®ä¸­æ ¸å“²å­¦ã‚’åæ˜ ã—ã¦ã„ã¾ã™ï¼š**é™ã‚‰ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ç„¡é™ã®ä¾¡å€¤ã‚’å‰µé€ ã™ã‚‹**ã€‚

## ã‚³ã‚¢æ©Ÿèƒ½

### ğŸš€ ç©¶æ¥µã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- **SIMDæœ€é©åŒ–Keyæ¯”è¼ƒ**: ARM64 NEONå‘½ä»¤ã‚»ãƒƒãƒˆã«åŸºã¥ãé«˜æ€§èƒ½æ¯”è¼ƒ
- **å¤šæ®µãƒ–ãƒ­ãƒƒã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ **: ãƒ›ãƒƒãƒˆ/ã‚¦ã‚©ãƒ¼ãƒ /ã‚³ãƒ¼ãƒ«ãƒ‰3éšå±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€LRUå‰Šé™¤æˆ¦ç•¥
- **ã‚¹ãƒãƒ¼ãƒˆãƒ–ãƒ«ãƒ¼ãƒ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**: 1%ã®å½é™½æ€§ç‡ã€å­˜åœ¨ã—ãªã„ã‚¯ã‚¨ãƒªã®é«˜é€Ÿãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- **ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒãƒ¡ã‚«ãƒ‹ã‚ºãƒ **: ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªãƒ—ãƒªãƒ•ã‚§ãƒƒãƒã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Š

### ğŸ”’ ä¸¦è¡Œå®‰å…¨æ€§
- **ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿æ§‹é€ **: concurrent-mapã«åŸºã¥ãé«˜ä¸¦è¡Œæ€§è¨­è¨ˆ
- **ã‚¹ãƒ¬ãƒƒãƒ‰å®‰å…¨æ€§**: å®Œå…¨ãªSend + Syncãƒˆãƒ¬ã‚¤ãƒˆå®Ÿè£…
- **åŸå­æ€§ä¿è¨¼**: ACIDäº’æ›ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚µãƒãƒ¼ãƒˆ

### ğŸ“¦ åŠ¹ç‡çš„ãªãƒ¡ãƒ¢ãƒªç®¡ç†
- **ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³**: I/Oã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å‰Šæ¸›ã™ã‚‹ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥
- **ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥**: é©å¿œçš„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç½®æ›ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- **ãƒ¡ãƒ¢ãƒªãƒãƒƒãƒ”ãƒ³ã‚°æœ€é©åŒ–**: åŠ¹ç‡çš„ãªãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```rust
use melange_db::{Db, Config};

fn main() -> anyhow::Result<()> {
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’è¨­å®š
    let config = Config::new()
        .path("/path/to/database")
        .cache_capacity_bytes(512 * 1024 * 1024); // 512MBã‚­ãƒ£ãƒƒã‚·ãƒ¥

    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é–‹ã
    let db: Db<1024> = config.open()?;

    // ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€
    let tree = db.open_tree("my_tree")?;
    tree.insert(b"key", b"value")?;

    // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
    if let Some(value) = tree.get(b"key")? {
        println!("Found value: {:?}", value);
    }

    // ç¯„å›²ã‚¯ã‚¨ãƒª
    for kv in tree.range(b"start"..b"end") {
        let (key, value) = kv?;
        println!("{}: {:?}", String::from_utf8_lossy(&key), value);
    }

    Ok(())
}
```

### åœ§ç¸®è¨­å®š

Melange DBã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚æ©Ÿèƒ½ã«ã‚ˆã‚‹åœ§ç¸®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®é¸æŠã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼š

#### ç„¡åœ§ç¸®ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€æœ€é«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼‰
```rust
use melange_db::{Db, Config, CompressionAlgorithm};

let config = Config::new()
    .path("/path/to/database")
    .compression_algorithm(CompressionAlgorithm::None);
```

#### LZ4åœ§ç¸®ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨åœ§ç¸®ç‡ã®ãƒãƒ©ãƒ³ã‚¹ï¼‰
```rust
use melange_db::{Db, Config, CompressionAlgorithm};

let config = Config::new()
    .path("/path/to/database")
    .compression_algorithm(CompressionAlgorithm::Lz4);
```

#### Zstdåœ§ç¸®ï¼ˆé«˜åœ§ç¸®ç‡ï¼‰
```rust
use melange_db::{Db, Config, CompressionAlgorithm};

let config = Config::new()
    .path("/path/to/database")
    .compression_algorithm(CompressionAlgorithm::Zstd);
```

### ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰

```bash
# ç„¡åœ§ç¸®ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
cargo build --release

# LZ4åœ§ç¸®
cargo build --release --features compression-lz4

# Zstdåœ§ç¸®
cargo build --release --features compression-zstd
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ

### Apple M1ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- **ç„¡åœ§ç¸®**: 1.07 Âµs/æ›¸ãè¾¼ã¿ã€0.36 Âµs/èª­ã¿å–ã‚Š
- **LZ4åœ§ç¸®**: 0.97 Âµs/æ›¸ãè¾¼ã¿ã€0.36 Âµs/èª­ã¿å–ã‚Š
- **Zstdåœ§ç¸®**: 1.23 Âµs/æ›¸ãè¾¼ã¿ã€0.40 Âµs/èª­ã¿å–ã‚Š

### ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æœ€é©åŒ–
- **ARM64 NEONæœ€é©åŒ–**: Apple Silicon M1 NEONå‘½ä»¤ã‚»ãƒƒãƒˆã®å®Œå…¨æ´»ç”¨
- **x86_64 SSE2/AVX2**: ãƒ­ãƒ¼ã‚¨ãƒ³ãƒ‰ã‹ã‚‰ãƒã‚¤ã‚¨ãƒ³ãƒ‰ã¾ã§ãƒ•ãƒ«ã‚«ãƒãƒ¼
- **é©å¿œçš„æœ€é©åŒ–**: ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ç‰¹æ€§ã«åŸºã¥ãã‚¹ãƒãƒ¼ãƒˆè¨­å®š

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

`Cargo.toml`ã«è¿½åŠ ï¼š

```toml
[dependencies]
melange_db = "0.1.5"
```

## ã‚µãƒ³ãƒ—ãƒ«

Melange DBã‚’ã‚ˆã‚Šè‰¯ãä½¿ç”¨ã™ã‚‹ãŸã‚ã®ã„ãã¤ã‹ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’æä¾›ã—ã¦ã„ã¾ã™ï¼š

### ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«
- **`performance_demo.rs`** - åŸºæœ¬çš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¢ã¨ã‚¹ãƒãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®ã‚·ãƒ§ãƒ¼ã‚±ãƒ¼ã‚¹
- **`accurate_timing_demo.rs`** - P50/P95/P99çµ±è¨ˆã‚’å«ã‚€æ­£ç¢ºãªã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ†æ

### ğŸ¯ åœ§ç¸®ã‚µãƒ³ãƒ—ãƒ«
- **`macbook_air_m1_compression_none.rs`** - ç„¡åœ§ç¸®ç©¶æ¥µãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- **`macbook_air_m1_compression_lz4.rs`** - NEONã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³LZ4åœ§ç¸®
- **`macbook_air_m1_compression_zstd.rs`** - é«˜åœ§ç¸®ç‡Zstd

### ğŸ¯ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚µãƒ³ãƒ—ãƒ«
- **`best_practices.rs`** - å®Œå…¨ãªæœ¬ç•ªç’°å¢ƒä½¿ç”¨ä¾‹

### ã‚µãƒ³ãƒ—ãƒ«ã®å®Ÿè¡Œ

```bash
# åŸºæœ¬çš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¢ã‚’å®Ÿè¡Œ
cargo run --example performance_demo

# æ­£ç¢ºãªã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ†æã‚’å®Ÿè¡Œ
cargo run --example accurate_timing_demo

# åœ§ç¸®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒã‚’å®Ÿè¡Œ
cargo run --example macbook_air_m1_compression_none --features compression-none --release
cargo run --example macbook_air_m1_compression_lz4 --features compression-lz4 --release
cargo run --example macbook_air_m1_compression_zstd --features compression-zstd --release
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯LGPL-3.0ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ - è©³ç´°ã¯[LICENSE](LICENSE)ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ­“è¿ã—ã¾ã™ï¼ãŠæ°—è»½ã«ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

## è¬è¾

- å„ªã‚ŒãŸ[sled](https://github.com/spacejam/sled)ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åŸºã¥ã„ã¦ã„ã¾ã™
- ãƒ•ãƒ©ãƒ³ã‚¯ãƒ»ãƒãƒ¼ãƒãƒ¼ãƒˆã®ã€Œãƒ‡ãƒ¥ãƒ¼ãƒ³ã€å®‡å®™ã«ã‚¤ãƒ³ã‚¹ãƒ‘ã‚¤ã‚¢ã•ã‚Œã¦ã„ã¾ã™
- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨ææ¡ˆã‚’æä¾›ã—ã¦ãã‚ŒãŸã™ã¹ã¦ã®ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ„Ÿè¬ã—ã¾ã™